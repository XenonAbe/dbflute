${database.allClassCopyright}package ${glPackageBaseCommonCBeanPagenaviRange};

#set ($myClassName = "${glPageRangeBeanName}")

import ${glPackageBaseCommonCBeanPagenavi}.${glPageNumberLinkName};
#if ($database.isAvailableGenerics())
import ${glPackageBaseCommonCBeanPagenavi}.${glPageNumberLinkSetupperName};
#end

/**
 * The bean of page range.
 * 
 * @author ${database.ClassAuthor}
 */
public class ${myClassName} implements java.io.Serializable {

    /** Serial version UID. (Default) */
    private static final long serialVersionUID = 1L;

    // ===================================================================================
    //                                                                           Attribute
    //                                                                           =========
    protected int _currentPageNumber;
    protected int _allPageCount;
    protected ${glPageRangeOptionName} _pageRangeOption;

    // ===================================================================================
    //                                                                                Main
    //                                                                                ====
#if ($database.isAvailableGenerics())
    /**
     * Build the list of page number link.
     * 
     * @param pageNumberLinkSetupper Page number link setupper. (NotNull and Required LINK_TYPE)
     * @return The list of Page number link. (NotNull)
     */
    public <LINK_TYPE extends ${glPageNumberLinkName}> java.util.List<LINK_TYPE> buildPageNumberLinkList(${glPageNumberLinkSetupperName}<LINK_TYPE> pageNumberLinkSetupper) {
        final java.util.List<Integer> pageNumberList = createPageNumberList();
        final java.util.List<LINK_TYPE> pageNumberLinkList = new java.util.ArrayList<LINK_TYPE>();
        for (Integer pageNumber: pageNumberList) {
            pageNumberLinkList.add(pageNumberLinkSetupper.setup(pageNumber, pageNumber.equals(_currentPageNumber)));
        }
        return pageNumberLinkList;
    }
#end

    /**
     * Create the list of page number.
     * 
     * @return The list of page number. (NotNull)
     */
    public java.util.List${database.filterGenericsString('Integer')} createPageNumberList() {
        assertPageRangeValid();
        final int pageRangeSize = _pageRangeOption.getPageRangeSize();
        final int allPageCount = _allPageCount;
        final int currentPageNumber = _currentPageNumber;

        final java.util.List${database.filterGenericsString('Integer')} resultList = new java.util.ArrayList${database.filterGenericsString('Integer')}();
        for (int i = currentPageNumber - pageRangeSize; i < currentPageNumber; i++) {
            if (i < 1) {
                continue;
            }
            resultList.add(new Integer(i));
        }

        resultList.add(new Integer(currentPageNumber));

        final int endPageNumber = (currentPageNumber + pageRangeSize);
        for (int i = currentPageNumber + 1 ; i <= endPageNumber && i <= allPageCount; i++) {
            resultList.add(new Integer(i));
        }

        final boolean fillLimit = _pageRangeOption.isFillLimit();
        final int limitSize = (pageRangeSize * 2) + 1;
        if (fillLimit && !resultList.isEmpty() && resultList.size() < limitSize) {
            final Integer firstElements = (Integer)resultList.get(0);
            final Integer lastElements = (Integer)resultList.get(resultList.size() - 1);
            if (firstElements.intValue() > 1) {
                for (int i = firstElements.intValue() - 1 ; resultList.size() < limitSize && i > 0; i--) {
                    resultList.add(0, new Integer(i));
                }
            }
            for (int i = lastElements.intValue() + 1 ; resultList.size() < limitSize && i <= allPageCount; i++) {
                resultList.add(new Integer(i));
            }
        }
        return resultList;
    }

    /**
     * Get the array of page number.
     * 
     * @return The array of page number.
     */
    public int[] createPageNumberArray() {
        assertPageRangeValid();
        return convertListToIntArray(createPageNumberList());
    }

    /**
     * Is existing previous page range?
     * 
     * @return Determination.
     */
    public boolean isExistPrePageRange() {
        assertPageRangeValid();
        final int[] array = createPageNumberArray();
        if (array.length == 0) {
            return false;
        }
        return array[0] > 1;
    }

    /**
     * Is existing next page range?
     * 
     * @return Determination.
     */
    public boolean isExistNextPageRange() {
        assertPageRangeValid();
        final int[] array = createPageNumberArray();
        if (array.length == 0) {
            return false;
        }
        return array[array.length-1] < _allPageCount;
    }

    protected int[] convertListToIntArray(java.util.List${database.filterGenericsString('Integer')} ls) {
        final int[] resultArray = new int[ls.size()];
        int arrayIndex = 0;
        for (final java.util.Iterator ite = ls.iterator(); ite.hasNext(); ) {
            final Integer tmpPageNumber = (Integer)ite.next();
            resultArray[arrayIndex] = tmpPageNumber.intValue();
            arrayIndex++;
        }
        return resultArray;
    }

    protected void assertPageRangeValid() {
        if (_pageRangeOption == null) {
            String msg = "The pageRangeOption should not be null. Please invoke setPageRangeOption().";
            throw new IllegalStateException(msg);
        }
        final int pageRangeSize = _pageRangeOption.getPageRangeSize();
        if (pageRangeSize == 0) {
            String msg = "The pageRangeSize should be greater than 1. But the value is zero.";
            throw new IllegalStateException(msg);
        }
    }

    // ===================================================================================
    //                                                                            Accessor
    //                                                                            ========
    public void setCurrentPageNumber(int currentPageNumber) {
        this._currentPageNumber = currentPageNumber;
    }
    public void setAllPageCount(int allPageCount) {
        this._allPageCount = allPageCount;
    }
    public void setPageRangeOption(${glPageRangeOptionName} pageRangeOption) {
        this._pageRangeOption = pageRangeOption;
    }

    // ===================================================================================
    //                                                                      Basic Override
    //                                                                      ==============
    /**
     * The override.
     * 
     * @return View string. (NotNull)
     */
    public String toString() {
        final StringBuffer sb = new StringBuffer();

        sb.append(" currentPageNumber=").append(_currentPageNumber);
        sb.append(" allPageCount=").append(_allPageCount);
        sb.append(" pageRangeOption=").append(_pageRangeOption);

        return sb.toString();
    }
}
