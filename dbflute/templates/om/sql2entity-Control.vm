

targetdatabase = $targetDatabase


#set ( $dbprops = $properties.load("sql/base/$targetDatabase/db.props") )
#include ( "sql/base/$targetDatabase/db.props" )

##
## Loop by data-model.
##
#foreach ($dataModel in $dataModels)

  ##
  ## Loop by database.
  ##
  #foreach ($database in $dataModel.Databases)

    ## ------------------------------------------------------------------
    ##                                                    Global-Paramter
    ##                                                    ---------------
    ## [Language]
    #set ($glTargetLanguage = ${database.TargetLanguage})

    ## [Extension]
    #set ($glTemplateFileExtension = ${database.TemplateFileExtension})
    #set ($glClassFileExtension = ${database.ClassFileExtension})

    ## [Prefix-and-Suffix]
    #set ($glProjectPrefix = ${database.ProjectPrefix})
    #set ($glBasePrefix = ${database.BasePrefix})
    #set ($glBaseSuffixForEntity = ${database.BaseSuffixForEntity})

    #set ($glDaoReadableInterfaceName = "${glProjectPrefix}DaoReadable")
    #set ($glDaoWritableInterfaceName = "${glProjectPrefix}DaoWritable")

    ## [Common-Entity]
    #set ($glEntityInterfaceName = "${glProjectPrefix}Entity")
    #set ($glEntityDefinedCommonColumnInterfaceName = "${glProjectPrefix}EntityDefinedCommonColumn")

    ## [ConditionBean]
    #set ($glConditionBeanInterfaceName = "${glProjectPrefix}ConditionBean")

    ## [DBMeta]
    #set ($glDBMetaInterfaceName = "${glProjectPrefix}DBMeta")
    #set ($glDBMetaAbstractName = "${glProjectPrefix}AbstractDBMeta")

    ## [Helper]
    #set ($glMapListStringName = "${glProjectPrefix}MapListString")
    #set ($glMapListStringImplName = "${glProjectPrefix}MapListStringImpl")
    #set ($glMapStringBuilderName = "${glProjectPrefix}MapStringBuilder")
    #set ($glMapStringBuilderImplName = "${glProjectPrefix}MapStringBuilderImpl")

    ## [ClassificationDefinition]
    #set ($glClassificationDefinition = "${glProjectPrefix}ClassificationDefinition")

    ## [Package]
    #set ($glPackageBaseCommon = "${database.baseCommonPackage}")
    #set ($glPackageBaseCommonCBean = "${database.baseCommonPackage}.cbean")
    #set ($glPackageBaseCommonDBMeta = "${database.baseCommonPackage}.dbmeta")
    #set ($glPackageBaseCommonHelper = "${database.baseCommonPackage}.helper")
    #set ($glPackageBaseDao = "${database.baseDaoPackage}" )
    #set ($glPackageBaseEntity = "${database.baseEntityPackage}")
    #set ($glPackageExtendedDao = "${database.extendedDaoPackage}")
    #set ($glPackageExtendedEntity = "${database.extendedEntityPackage}")

    ## [Other]
    #set ($glConditionBeanInitialName = "CB")
    #set ($glConditionQueryInitialName = "CQ")
    #set ($glAttachedCBArgsVariableName = "cb")
    #set ($glParentVariablePrefix = "_parent")
    #set ($glChildrenVariablePrefix = "_children")

    ## -----------------------------------------------------------------------------------------------------
    ##                                                                                 Parse cutomize entity
    ##                                                                                 ---------------------
    ## Setup java directory.
    $database.setupJavaDir_for_sql2entity()

    #set ($glPackageBaseCustomizeEntity = "${database.Sql2EntityBaseEntityPackage}" )
    #set ($glPackageCustomizeDBMeta = "${database.Sql2EntityDBMetaPackage}")
    #set ($glPackageExtendedCustomizeEntity = "${database.Sql2EntityExtendedEntityPackage}" )

    #set ($path = $strings.getPackageAsPath(${glPackageBaseCustomizeEntity}))
    $database.makeDirectory($path)

    #if (!$database.isSql2EntityPlainEntity())
      #set ($path = $strings.getPackageAsPath(${glPackageCustomizeDBMeta}))
      $database.makeDirectory($path)
    #end

    #set ($path = $strings.getPackageAsPath(${glPackageExtendedCustomizeEntity}))
    $database.makeDirectory($path)

    $database.debug("public void parseCustomizeEntity() {")
    $database.debug("    final List<String> tableNameList = getTableList();")
    $database.debug("    for (String tableName : tableNameList) {")
    #foreach ($table in $database.TableList)
      #set ($myBaseObjectClassName = "${glProjectPrefix}${glBasePrefix}${table.JavaName}")
      #set ($myBaseEntityPackageName = "${glPackageBaseCustomizeEntity}")
      #set ($myExtendedObjectClassName = "${glProjectPrefix}${table.JavaName}")
      #set ($myExtendedEntityPackageName = "${glPackageExtendedCustomizeEntity}")
      #set ($myDBMetaClassName = "${glProjectPrefix}${table.JavaName}Dbm")
      #set ($myDBMetaPackageName = "${glPackageCustomizeDBMeta}")

      #set ($isExistDao = false)
      #set ($isExistConditionBean = false)

      #if ($database.isSql2EntityPlainEntity())
        $database.debug("        parseBaseCustomizeEntity(tableName);     // ${myBaseObjectClassName}")
        #set ( $path = "${strings.getPackageAsPath(${myBaseEntityPackageName})}${myBaseObjectClassName}.${glClassFileExtension}" )
        $generator.parse("om/${glTargetLanguage}/bsentity/PlainBaseEntity.${glTemplateFileExtension}",$path ,"" ,"")
      #else
        $database.debug("        parseBaseCustomizeEntity(tableName);     // ${myBaseObjectClassName}")
        #set ( $path = "${strings.getPackageAsPath(${myBaseEntityPackageName})}${myBaseObjectClassName}.${glClassFileExtension}" )
        $generator.parse("om/${glTargetLanguage}/bsentity/BaseEntity.${glTemplateFileExtension}",$path ,"" ,"")

        $database.debug("        parseCustomizeDBMeta(tableName);         // ${myDBMetaClassName}")
        #set ( $path = "${strings.getPackageAsPath(${myDBMetaPackageName})}${myDBMetaClassName}.${glClassFileExtension}" )
        $generator.parse("om/${glTargetLanguage}/bsentity/dbmeta/DBMetaImpl.${glTemplateFileExtension}",$path,"", "")
      #end

      #set ( $path = "${strings.getPackageAsPath(${myExtendedEntityPackageName})}${myExtendedObjectClassName}.${glClassFileExtension}" )
      #if (!$files.file(${generator.OutputPath},$path).exists())
        $database.debug("        parseExtendedCustomizeEntity(tableName); // ${myExtendedObjectClassName}")
        $generator.parse("om/${glTargetLanguage}/exentity/ExtendedEntity.${glTemplateFileExtension}",$path ,"" ,"")
      #end

    #end
    $database.debug("    }")
    $database.debug("}")

    ## -----------------------------------------------------------------------------------------------------
    ##                                                                                  Parse parameter bean
    ##                                                                                  --------------------
    #if ($database.isExistPmbMetaData())
    $database.debug("public void parseParameterBean() {")
    $database.debug("    final List<DfParameterBeanMetaData> parameterBeanList = getParameterBeanList();")
    $database.debug("    for (DfParameterBeanMetaData parameterBean : parameterBeanList) {")

    #set ($glPackageBaseParameterBean = "${database.Sql2EntityBaseParameterBeanPackage}" )
    #set ($glPackageExtendedParameterBean = "${database.Sql2EntityExtendedParameterBeanPackage}" )

      #set ($path = $strings.getPackageAsPath(${glPackageBaseParameterBean}))
      $database.makeDirectory($path)
      #set ($path = $strings.getPackageAsPath(${glPackageExtendedParameterBean}))
      $database.makeDirectory($path)

      #foreach ($pmbMetaData in $database.pmbMetaDataList)
        #set ($pmbClassName = "$pmbMetaData.className")
        #set ($pmbSuperClassName = "$pmbMetaData.superClassName")
        #set ($myBaseParameterBeanClassName = "${glProjectPrefix}${glBasePrefix}${pmbClassName}")
        #set ($myExtendedParameterBeanClassName = "${glProjectPrefix}${pmbClassName}")

        $database.debug("        parseBaseParameterBean(parameterBean);     // ${myBaseParameterBeanClassName}")
        #set ( $path = "${strings.getPackageAsPath(${glPackageBaseParameterBean})}${myBaseParameterBeanClassName}.${glClassFileExtension}" )
        $generator.parse("om/${glTargetLanguage}/bsdao/BsParameterBean.${glTemplateFileExtension}",$path ,"" ,"")

        #set ( $path = "${strings.getPackageAsPath(${glPackageExtendedParameterBean})}${myExtendedParameterBeanClassName}.${glClassFileExtension}" )
        #if (!$files.file(${generator.OutputPath},$path).exists())
          $database.debug("        parseExtendedParameterBean(parameterBean); // ${myExtendedParameterBeanClassName}")
          $generator.parse("om/${glTargetLanguage}/exdao/ExParameterBean.${glTemplateFileExtension}",$path ,"" ,"")
        #end
      #end
    $database.debug("    }")
    $database.debug("}")
    #end

  #end
#end
